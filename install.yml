---
- name: Deploy dev-tools-linux
  hosts:
    - localhost

  pre_tasks:
    - name: Get the username running the deploy
      become: false
      shell: whoami
      register: dev_whoami

    - name: Set the devtools_user
      set_fact:
        devtools_user: "{{dev_whoami.stdout}}"
      when:
        - (devtools_user is not defined)

    - name: Determine the actual name of the user
      become: false
      shell: echo {{devtools_user}} | sed -e 's/\./\ /g' | sed -e 's/\b\(.\)/\u\1/g'
      register: dev_name

    - name: Set the devtools_name
      set_fact:
        devtools_name: "{{dev_name.stdout}}"
      when:
        - (devtools_name is not defined)

    - name: Set the devtools_path
      set_fact:
        devtools_path: "/home/{{devtools_user}}/.dev-tools"

  roles:
    # Install utility scripts/applications
    - role: install_base
      vars:
        user_name: "{{devtools_user}}"
        real_name: "{{devtools_name}}"
    # Install utility scripts/applications
    - role: install_sdks
      vars:
        user_name: "{{devtools_user}}"
    # Install arcanist on the workstation
    - role: install_arcanist
      vars:
        install_path: "{{devtools_path}}"
    # Install linters used by arcanist/dev workflow
    - role: install_linters
      vars:
        install_path: "{{devtools_path}}"
    - role: install_utils
    # Inspection tests of the install
    - role: validate
