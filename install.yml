---
- name: Deploy DEV-TOOLS
  hosts:
    - localhost

  pre_tasks:
    - name: get the username running the deploy
      become: false
      local_action: command whoami
      register: whoami

    - name: set the devtools_user
      set_fact:
        devtools_user: "{{ whoami.stdout }}"
      when:
        - (devtools_user is not defined)

    - name: set the devtools_path
      set_fact:
        devtools_path: "/home/{{ devtools_user }}/.dev-tools"

  roles:
    # Install utility scripts/applications
    - role: base_install
      become_user: "{{ devtools_user }}"
      become: yes
    # Install arcanist on the workstation
    - role: arcanist_core
      vars:
        install_path: "{{ devtools_path }}"
      become_user: "{{ devtools_user }}"
      become: yes
    # Install linters used by arcanist/dev workflow
    - role: arcanist_linters
      vars:
        install_path: "{{ devtools_path }}"
      become_user: "{{ devtools_user }}"
      become: yes
    # Install utility scripts/applications
    - role: sdk_install
      vars:
        install_user: "{{ devtools_user }}"
      become_user: "{{ devtools_user }}"
      become: yes
    - role: install_utils
      vars:
        install_user: "{{ devtools_user }}"
      become_user: root
      become: yes
    # Inspection tests of the install
    - role: test_install
      become_user: "{{ devtools_user }}"
      become: yes
