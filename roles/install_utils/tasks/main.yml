---

- name: Delete old scripts
  file:
    state: absent
    path: /usr/local/bin/{{item}}
  become_user: root
  become: yes
  loop:
    - arc-status
  ignore_errors: "{{ansible_check_mode}}"

- name: Set up arcanist scripts
  template:
    src: "{{item}}.sh.j2"
    dest: /usr/local/bin/{{item}}
    mode: 0755
  become_user: root
  become: yes
  loop:
    - git-clone-all
    - git-mirror
    - git-status-all
  ignore_errors: "{{ansible_check_mode}}"

- name: Ensure make-release
  template:
    src: make-release.j2
    dest: /usr/local/bin/make-release
    mode: 0755
  become: yes
  ignore_errors: "{{ansible_check_mode}}"

- name: Unpack adr-j lib
  unarchive:
    src: "{{repository}}/elhub-bin/adr-j/{{adr_version}}/adr-j.zip"
    dest: /usr/local/lib
    remote_src: yes
  become: yes
  ignore_errors: "{{ansible_check_mode}}"

- name: Link adr
  file:
    src: /usr/local/lib/adr-j-{{adr_version}}/bin/adr-j
    dest: /usr/local/bin/adr
    state: link
  become: yes
  ignore_errors: "{{ansible_check_mode}}"
